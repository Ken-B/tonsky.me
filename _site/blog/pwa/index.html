<!doctype html>
<html lang="en" prefix="og: http://ogp.me/ns#" xmlns:og="http://opengraphprotocol.org/schema/">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
  
    <meta name="viewport" content="width=640" />
  
  <meta name="theme-color" content="#FDDB29">
  <link href="/i/favicon.png" rel="icon" sizes="32x32">

  <link href='/style.css?v=20201203' rel='stylesheet' type='text/css' />
  <title>You need neither PWA nor AMP to make your website load fast @ tonsky.me</title>

  <link href="/blog/atom.xml" rel="alternate" title="Nikita Prokopov’s blog" type="application/atom+xml" />

  <meta name="author" content="Nikita Prokopov" />
  
  <meta property="og:title" content="You need neither PWA nor AMP to make your website load fast" />
  <meta property="og:url" content="https://tonsky.me/blog/pwa/" />
  
    <meta property="og:type" content="article" />

    <meta property="article:published_time" content='2018-11-21' />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="You need neither PWA nor AMP to make your website load fast" />
  

  
    <meta property="og:description" content="Good performance practices are still needed when developing fast web experience." />
    <meta name="twitter:description" content="Good performance practices are still needed when developing fast web experience." />
  

  <meta property="og:site_name" content="tonsky.me" />
  <meta property="article:author" content="https://www.facebook.com/nikitonsky" />
  <meta property="profile:first_name" content="Nikita" />
  <meta property="profile:last_name" content="Prokopov" />
  <meta property="profile:username" content="tonsky" />
  <meta property="profile:gender" content="male" />

  <meta name="twitter:creator" content="@nikitonsky" />
</head>
<body>
<div class="page ">

<ul class=menu>
  <li><a class="menu__item menu__item_inside" href="/">Blog</a></li>
  <li><a class="menu__item" href="/talks/">Talks</a></li>
  <li><a class="menu__item" href="/projects/">Projects</a></li>
  <li><a class="menu__item" href="/design/">Logos</a></li>
  <!-- <li><a class="menu__item" href="/consulting/">UX&nbsp;Consulting</a></li> -->
  <li><a class="menu__item" href="/patrons/">Patrons</a></li>
  <div class="spacer"></div>
  <div class="dark_mode"></div>
</ul>


<article class="post">
  <h1 class="title">You need neither PWA nor AMP to make your website load fast</h1>

  <p></p>

  <p><em>Translations: <a href="https://habr.com/ru/company/timeweb/blog/555094/">Russian</a></em></p>

<p>There has been a trend of new “revolutionary” techniques on the Web that basically let you do stuff possible decades ago.</p>

<h1 id="amp">AMP</h1>

<p>First, AMP (Accelerated Mobile Pages). Think about it: web, in general, failed to be fast, so Google invents a parallel web where they simply don’t let you use JavaScript. Oh, and they let you use a couple of Google-approved AMP JS components. But wait, can’t regular web run without JavaScript? Of course it can. Can regular web include custom JS components? You bet. Can it be fast? Netflix <a href="https://medium.com/dev-channel/a-netflix-web-performance-case-study-c0bcde26a9d9">recently found out</a> that if they remove 500 Kb of JavaScript from a static (!!!) webpage it will load WAY faster and users will generally be happier. Who would have thought, right?</p>

<p>So why was AMP needed? Well, basically Google needed to lock content providers to be served through Google Search. But they needed a good cover story for that. And they chose to promote it as a performance solution.</p>

<p>Thing is, web developers don’t believe in performance. They <em>say</em> they do, but in reality, they don’t. What they believe in is hype. So if you hype old tricks under a new name, then developers can say “Now, finally, I can start writing fast apps. Thank you Google!”. Like if Google ever stopped you from doing so beforehand.</p>

<blockquote>
  <p>“But AMP is new! <code class="language-plaintext highlighter-rouge">&lt;amp-img&gt;</code> does so much more than <code class="language-plaintext highlighter-rouge">&lt;img&gt;</code>!”</p>
</blockquote>

<p>It might, but what stops Google, if it really has an intention to help, from releasing it as a regular JS library?</p>

<p>So hype worked, lots of developers bought the cover story and rushed creating a parallel version of every webpage they serve with “AMP-enabled” performance boost.</p>

<p>Before:</p>

<blockquote>
  <p>“Hey boss, let’s rewrite our website to make it load fast!”<br />“Fuck off!”<br />“But studies show that every second of load time…”<br />“I said fuck off!”</p>
</blockquote>

<p>Now:</p>

<blockquote>
  <p>“Hey boss, let’s rewrite our website with AMP. It’s a new tech by Google…”<br />“Drop everything! Here, take $$$”<br />“It also might improve…”<br />“I don’t care. Get on this NOW!”</p>
</blockquote>

<p>I’m not saying practices promoted by AMP are bad or useless. They are good practices. But nothing stops you from following them in the regular web. Nothing has ever stopped you from writing performant pages, from the very inception of the web. Google hardly invented CDNs and async script loading. But nobody cared because old tech and good practices are never as tempting as something branded as “new”.</p>

<h1 id="pwa">PWA</h1>

<p>Enter PWA. Progressive Web Applications. Or Apps. Progressive Web Apps. Whatever.</p>

<p>So the idea was to be able to create a native-like experience but with web stack. What was the Web missing? Installing apps. Offline mode. Notifications (Ew). Working in the background. Yeah, that’s basically it. That’s it.</p>

<p>Again, I’m not going to say these things are wrong.<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup> They are not. If you want to create a native-like app using web technologies, you’ll have to use something like that. And it makes sense for apps like a shopping list or, I don’t know, alarm clock?</p>

<p>The problem with PWA is, well, there are two problems.</p>

<p>First is that most apps would be better off as websites rather than apps. Websites load each resource gradually, as it’s needed, unlike apps which have to fetch everything at install (that’s why app bundle sizes are usually way bigger than websites). Sites are more efficient but you can’t use them while offline.</p>

<p>But most “apps” today are online-only anyways! You can’t call Uber while being offline, and why would you open Uber app otherwise? Tinder is useless offline. You can’t date empty chat screens. You can’t join a meetup at Meetup.com without network connection. You can’t choose or book a hotel, you can’t transfer money or check your account balance offline. And nobody wants to re-read old cached tweets from Twitter or yesterday photos from Instagram. It just doesn’t make any sense.</p>

<p>So yeah, I would prefer those “apps” to be just websites. Believe it or not, there are benefits to that. I enjoy smaller download size, especially if I visit a site occasionally just for a quick look. I enjoy that websites do not consume my resources in the background.<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup> When I close it it unloads and does not constantly download new versions of its own libraries, which <a href="https://medium.com/@paularmstrong/d28a00e780a3#8255">developers frequently need to deploy</a>. I’m more than ready to sacrifice offline mode for that.</p>

<p>The second problem with PWA, and more relevant to our topic, is that it somehow <a href="https://www.thinkwithgoogle.com/intl/en-154/insights-inspiration/case-studies/trivago-embrace-progressive-web-apps-as-the-future-of-mobile/">got associated with performance</a>.</p>

<p>The thing is, it has nothing to do with performance. I mean, nothing <em>new</em>. You were always able to cache resources to make navigation between pages quick, and browsers are pretty good at doing so. With HTTP/2 you can efficiently fetch resources in bulk and even push resources from the server for a “more instant” experience.</p>

<p>So managing resource cache yourself, in a ServiceWorker, seems more like a burden than a blessing. HTTP caching is also declarative, well-tested and well understood at this point, in other words, hard to screw up. Which you can’t say about your ServiceWorker. Caching is one of two <a href="https://www.martinfowler.com/bliki/TwoHardThings.html">hardest things in Computer Science</a>. I personally <a href="https://twitter.com/nikitonsky/status/1064899552069722112">had a bad experience</a> with Meetup.com PWA when an error in their cache code made the whole site unusable to the point where it wouldn’t open meetup pages. And unlike HTTP, it’s not that easy to reset. Nope, refresh didn’t help.</p>

<p>But it would’ve been ok if ServiceWorker was a tradeoff: you pay complexity fee but get exciting new capabilities. Except you don’t. Nothing useful that you can do with ServiceWorker you can’t do with HTTP cache/AJAX/REST/Local Storage. It’s just a complexity hole you’ll sink countless workhours in.</p>

<p>PWA, as well as AMP, doesn’t even guarantee your website would be anywhere near “fast” or “instant”. It’s kind of funny how <a href="https://medium.com/@addyosmani/78919d98ece0">Tinder case study</a> shows that login screen (one text input, one button, one SVG logo and a background gradient) takes 5 seconds to load on a 4G connection! I mean, they had to add loader for 2-5 seconds so users don’t close this bullshit immediately. And they call it fast.</p>

<p>This is fast:</p>

<figure><video autoplay="" muted="" loop="" preload="auto" playsinline="" controls="" style="width: 300px; "><source src="./wikipedia.mp4" type="video/mp4" /></video></figure>

<p>How did they do it? By fucking caring about performance. As simple as that.</p>

<p>Oh, also not serving a gazillion of JavaScript bundles and not rendering on a client with React served over GraphQL via fetch polyfill. That probably helped too.</p>

<figure><a href="./airbnb.png" target="_blank"><img src="./airbnb.jpg" /></a></figure>

<p>ServiceWorker or AMP, if your landing page is 170+ requests for 3.1 Mb for an image and four form fields, it can’t load fast no matter how many new frameworks you throw at it.</p>

<h1 id="verdict">Verdict</h1>

<p>So what’s the verdict? To write fast websites with AMP and PWA you still need to understand performance optimization deeply. Without that, the only choice you have is to go with the hype.</p>

<p>But remember that neither AMP nor PWA would magically make your website any faster than say just a regular rewrite would.</p>

<figure>
  <a href="./index.png" target="_blank"><img src="./index.jpg" /></a>
  Airbnb famous 800Kb index page. I would expect more care perf-wise from 900+ developers with average salary of $290,000/year. Even SublimeText gives up highlighting this bullshit at some point. 
</figure>

<p>Once you understand performance, though, you’ll notice you need neither AMP nor PWA. Just stop doing bullshit and web suddenly starts to work <em>instantly</em>. AMP didn’t invent CDN and <code class="language-plaintext highlighter-rouge">&lt;noscript&gt;</code>. PWA didn’t invent caching. Static web still runs circles around any modern-day much-hyped framework.</p>

<figure><img src="./oldweb.png" /></figure>

<p>“But the users! They want our fancy-schmancy interactivity. They DEMAND animations!”</p>

<p>I’ll tell you one thing. No one enjoys staring at the loading screen for 5 seconds. Loader being animated doesn’t make any difference. If you can’t into performance, at least don’t pretend it’s a feature.</p>

<div class="footnotes-br"></div>

<script>
  if (!localStorage.getItem("first_opened"))
    localStorage.setItem("first_opened", "" + new Date().getTime());
  var first_opened = parseInt(localStorage.getItem("first_opened"));

  function update_downloaded() {
    var downloaded_kb = Math.ceil((new Date().getTime() - first_opened) / 200);
        text = downloaded_kb >= 1000000 ? Math.ceil(downloaded_kb / 1000) / 1000 + " Gb"
               : downloaded_kb >= 1000 ? downloaded_kb / 1000 + " Mb"
               : downloaded_kb + " Kb";
    document.getElementById("downloaded").innerHTML = text;
  }
  update_downloaded();
  setInterval(update_downloaded, 1000);

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js', {scope: '/'}).then(function(registration) {
      console.log('Service worker registration succeeded:', registration);
    });
  }

</script>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Although I don’t think we need more notifications in our life either. Especially <a href="https://grumpy.website/post/0PKEDf3JE">not from random web pages we visit</a>. Even not from native apps—I keep my phone in permanent Do Not Disturb mode with a short list of whitelisted apps. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>By the way, since you first opened this article my ServiceWorker has downloaded <code id="downloaded">0 Kb</code> of useless data in background. I hope you are on WiFi :) <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>


  <p class=footer>
    <span>November 21, 2018</span>
    

    
      <span class="separator">·</span>
      <span>Discuss on</span>
      
        <a href="https://news.ycombinator.com/item?id=18624128" target="_blank">HackerNews</a>
      
      
      
      
    
  </p>

  <script>
    document.querySelectorAll(".hoverable").forEach(function (e) {
        e.onclick = function() { e.classList.toggle("clicked"); }
    });
  </script>

  
  <div class="about">
    <div class="about_photo"></div>
    <div class="about_inner">
      <p>Hi!</p>
      <p>I’m Nikita. Here I write about programming and UI design <a style="margin-left: 5px" class="btn-subscribe" href="/blog/how-to-subscribe/" target="_blank"><svg viewBox="0 0 800 800"><path d="M493 652H392c0-134-111-244-244-244V307c189 0 345 156 345 345zm71 0c0-228-188-416-416-416V132c285 0 520 235 520 520z"/><circle cx="219" cy="581" r="71"/></svg> Subscribe</a></p>
      <p>I also create open-source stuff: Fira Code, AnyBar, DataScript and Rum. If you like what I do and want to get early access to my articles (along with other benefits), you should <a href="https://patreon.com/tonsky" target="_blank">support me on Patreon</a>.</p>
    </div>
  </div>
  

</article>


<div class="preload"></div>

</div>

<script>
  function updateFlashlight(e) {
    var style = document.body.style;
    style.backgroundPositionX = e.pageX - 250 + "px";
    style.backgroundPositionY = e.pageY - 250 + "px";
  }

  document.querySelector(".dark_mode").onclick = function(e) {
    var body = document.body;
    body.classList.toggle("dark");
    if (body.classList.contains("dark")) {
      updateFlashlight(e);
      ["mousemove", "touchstart", "touchmove", "touchend"].forEach(function(s) {
        document.documentElement.addEventListener(s, updateFlashlight, false);
      });
    } else {
      ["mousemove", "touchstart", "touchmove", "touchend"].forEach(function(s) {
        document.documentElement.removeEventListener(s, updateFlashlight, false);
      });
    }
  }
</script>
